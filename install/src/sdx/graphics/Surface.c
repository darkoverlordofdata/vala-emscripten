/* Surface.c generated by valac 0.34.8, the Vala compiler
 * generated from Surface.vala, do not modify */


#include <glib.h>
#include <glib-object.h>
#include <SDL2/SDL_surface.h>
#include <stdlib.h>
#include <string.h>
#include <SDL2/SDL_image.h>
#include <SDL2/SDL_rwops.h>


#define SDX_GRAPHICS_TYPE_SURFACE (sdx_graphics_surface_get_type ())
#define SDX_GRAPHICS_SURFACE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), SDX_GRAPHICS_TYPE_SURFACE, sdxgraphicsSurface))
#define SDX_GRAPHICS_SURFACE_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), SDX_GRAPHICS_TYPE_SURFACE, sdxgraphicsSurfaceClass))
#define SDX_GRAPHICS_IS_SURFACE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), SDX_GRAPHICS_TYPE_SURFACE))
#define SDX_GRAPHICS_IS_SURFACE_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), SDX_GRAPHICS_TYPE_SURFACE))
#define SDX_GRAPHICS_SURFACE_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), SDX_GRAPHICS_TYPE_SURFACE, sdxgraphicsSurfaceClass))

typedef struct _sdxgraphicsSurface sdxgraphicsSurface;
typedef struct _sdxgraphicsSurfaceClass sdxgraphicsSurfaceClass;
typedef struct _sdxgraphicsSurfacePrivate sdxgraphicsSurfacePrivate;
#define _SDL_FreeSurface0(var) ((var == NULL) ? NULL : (var = (SDL_FreeSurface (var), NULL)))
#define _g_free0(var) (var = (g_free (var), NULL))
#define _SDL_FreeRW0(var) ((var == NULL) ? NULL : (var = (SDL_FreeRW (var), NULL)))

struct _sdxgraphicsSurface {
	GObject parent_instance;
	sdxgraphicsSurfacePrivate * priv;
	SDL_Surface* surface;
	gint width;
	gint height;
	gint id;
	gchar* path;
};

struct _sdxgraphicsSurfaceClass {
	GObjectClass parent_class;
};


static gpointer sdx_graphics_surface_parent_class = NULL;
extern gint sdx_graphics_surface_uniqueId;
gint sdx_graphics_surface_uniqueId = 0;

GType sdx_graphics_surface_get_type (void) G_GNUC_CONST;
enum  {
	SDX_GRAPHICS_SURFACE_DUMMY_PROPERTY
};
sdxgraphicsSurface* sdx_graphics_surface_new (const gchar* path);
sdxgraphicsSurface* sdx_graphics_surface_construct (GType object_type, const gchar* path);
static void sdx_graphics_surface_finalize (GObject* obj);


sdxgraphicsSurface* sdx_graphics_surface_construct (GType object_type, const gchar* path) {
	sdxgraphicsSurface * self = NULL;
	const gchar* _tmp0_ = NULL;
	gchar* _tmp1_ = NULL;
	const gchar* _tmp2_ = NULL;
	SDL_RWops* _tmp3_ = NULL;
	SDL_RWops* _tmp4_ = NULL;
	SDL_Surface* _tmp5_ = NULL;
	SDL_Surface* _tmp6_ = NULL;
	gint _tmp7_ = 0;
	SDL_Surface* _tmp8_ = NULL;
	gint _tmp9_ = 0;
	g_return_val_if_fail (path != NULL, NULL);
	self = (sdxgraphicsSurface*) g_object_new (object_type, NULL);
	_tmp0_ = path;
	_tmp1_ = g_strdup (_tmp0_);
	_g_free0 (self->path);
	self->path = _tmp1_;
	_tmp2_ = path;
	_tmp3_ = SDL_RWFromFile (_tmp2_, "r");
	_tmp4_ = _tmp3_;
	_tmp5_ = IMG_LoadPNG_RW (_tmp4_);
	_SDL_FreeSurface0 (self->surface);
	self->surface = _tmp5_;
	_SDL_FreeRW0 (_tmp4_);
	_tmp6_ = self->surface;
	_tmp7_ = _tmp6_->w;
	self->width = _tmp7_;
	_tmp8_ = self->surface;
	_tmp9_ = _tmp8_->h;
	self->height = _tmp9_;
	return self;
}


sdxgraphicsSurface* sdx_graphics_surface_new (const gchar* path) {
	return sdx_graphics_surface_construct (SDX_GRAPHICS_TYPE_SURFACE, path);
}


static void sdx_graphics_surface_class_init (sdxgraphicsSurfaceClass * klass) {
	sdx_graphics_surface_parent_class = g_type_class_peek_parent (klass);
	G_OBJECT_CLASS (klass)->finalize = sdx_graphics_surface_finalize;
}


static void sdx_graphics_surface_instance_init (sdxgraphicsSurface * self) {
	gint _tmp0_ = 0;
	gint _tmp1_ = 0;
	_tmp0_ = sdx_graphics_surface_uniqueId;
	sdx_graphics_surface_uniqueId = _tmp0_ + 1;
	_tmp1_ = sdx_graphics_surface_uniqueId;
	self->id = _tmp1_;
}


static void sdx_graphics_surface_finalize (GObject* obj) {
	sdxgraphicsSurface * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, SDX_GRAPHICS_TYPE_SURFACE, sdxgraphicsSurface);
	_SDL_FreeSurface0 (self->surface);
	_g_free0 (self->path);
	G_OBJECT_CLASS (sdx_graphics_surface_parent_class)->finalize (obj);
}


/**
 * a reference counted wrapper for surface
 * prevents the surface memory from being reclaimed 
 * 
 */
GType sdx_graphics_surface_get_type (void) {
	static volatile gsize sdx_graphics_surface_type_id__volatile = 0;
	if (g_once_init_enter (&sdx_graphics_surface_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (sdxgraphicsSurfaceClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) sdx_graphics_surface_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (sdxgraphicsSurface), 0, (GInstanceInitFunc) sdx_graphics_surface_instance_init, NULL };
		GType sdx_graphics_surface_type_id;
		sdx_graphics_surface_type_id = g_type_register_static (G_TYPE_OBJECT, "sdxgraphicsSurface", &g_define_type_info, 0);
		g_once_init_leave (&sdx_graphics_surface_type_id__volatile, sdx_graphics_surface_type_id);
	}
	return sdx_graphics_surface_type_id__volatile;
}



