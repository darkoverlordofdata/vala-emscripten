/* main.c generated by valac 0.34.7, the Vala compiler
 * generated from main.gs, do not modify */


#include <glib.h>
#include <glib-object.h>
#include <stdlib.h>
#include <string.h>
#include <SDL2/SDL.h>
#include <SDL2/SDL_image.h>
#include <SDL2/SDL_hints.h>
#include <SDL_ttf.h>
#include <SDL2/SDL_video.h>
#include <SDL2/SDL_render.h>
#include <emscripten.h>
#include <float.h>
#include <math.h>

#define _g_free0(var) (var = (g_free (var), NULL))
#define _SDL_DestroyWindow0(var) ((var == NULL) ? NULL : (var = (SDL_DestroyWindow (var), NULL)))
#define _SDL_DestroyRenderer0(var) ((var == NULL) ? NULL : (var = (SDL_DestroyRenderer (var), NULL)))
typedef struct _Game Game;
void game_release (Game* self);
void game_free (Game* self);
Game* game_addRef (Game* self);
#define _game_release0(var) ((var == NULL) ? NULL : (var = (game_release (var), NULL)))


extern gint k;
gint k = 0;
extern gdouble t;
gdouble t = 0.0;
extern gdouble t1;
gdouble t1 = 0.0;
extern gdouble t2;
gdouble t2 = 0.0;
extern gdouble t3;
gdouble t3 = 0.0;

void _vala_main (gchar** args, int args_length1);
void game_free (Game* self);
Game* game_new (gint width, gint height, SDL_Renderer* renderer);
void game_initialize (Game* self);
void game_start (Game* self);
void mainloop (void* arg);
static void _mainloop_em_arg_callback_func (void* arg);
void game_update (Game* self);
void game_draw (Game* self);


static void _mainloop_em_arg_callback_func (void* arg) {
	mainloop (arg);
}


void _vala_main (gchar** args, int args_length1) {
	gchar* name = NULL;
	gchar* _tmp0_ = NULL;
	gint width = 0;
	gint height = 0;
	gint _tmp1_ = 0;
	gint _tmp3_ = 0;
	gboolean _tmp4_ = FALSE;
	gint _tmp5_ = 0;
	SDL_Window* window = NULL;
	const gchar* _tmp6_ = NULL;
	gint _tmp7_ = 0;
	gint _tmp8_ = 0;
	SDL_Window* _tmp9_ = NULL;
	SDL_Window* _tmp10_ = NULL;
	SDL_Renderer* renderer = NULL;
	SDL_Window* _tmp12_ = NULL;
	SDL_Renderer* _tmp13_ = NULL;
	SDL_Renderer* _tmp14_ = NULL;
	Game* game = NULL;
	SDL_Renderer* _tmp16_ = NULL;
	Game* _tmp17_ = NULL;
	Game* _tmp18_ = NULL;
	Game* _tmp19_ = NULL;
	Game* _tmp20_ = NULL;
	_tmp0_ = g_strdup ("Shmupwarz");
	name = _tmp0_;
	width = 600;
	height = 400;
	_tmp1_ = SDL_Init ((guint32) ((SDL_INIT_VIDEO | SDL_INIT_TIMER) | SDL_INIT_EVENTS));
	if (_tmp1_ < 0) {
		const gchar* _tmp2_ = NULL;
		_tmp2_ = SDL_GetError ();
		g_print ("Unable to init SDL %s\n", _tmp2_);
		_g_free0 (name);
		return;
	}
	_tmp3_ = IMG_Init ((gint) IMG_INIT_PNG);
	if (_tmp3_ < 0) {
		g_print ("SDL_image could not initialize!\n");
	}
	_tmp4_ = SDL_SetHint (SDL_HINT_RENDER_SCALE_QUALITY, "1");
	if (!_tmp4_) {
		g_print ("Warning: Linear texture filtering not enabled!!\n");
	}
	_tmp5_ = TTF_Init ();
	if (_tmp5_ == (-1)) {
		g_print ("SDL_ttf could not initialize!\n");
	}
	_tmp6_ = name;
	_tmp7_ = width;
	_tmp8_ = height;
	_tmp9_ = SDL_CreateWindow (_tmp6_, (gint) SDL_WINDOWPOS_CENTERED_MASK, (gint) SDL_WINDOWPOS_CENTERED_MASK, _tmp7_, _tmp8_, (guint32) SDL_WINDOW_SHOWN);
	window = _tmp9_;
	_tmp10_ = window;
	if (_tmp10_ == NULL) {
		const gchar* _tmp11_ = NULL;
		_tmp11_ = SDL_GetError ();
		g_print ("Unable to open window %s\n", _tmp11_);
		_SDL_DestroyWindow0 (window);
		_g_free0 (name);
		return;
	}
	_tmp12_ = window;
	_tmp13_ = SDL_CreateRenderer (_tmp12_, -1, (guint32) (SDL_RENDERER_ACCELERATED | SDL_RENDERER_PRESENTVSYNC));
	renderer = _tmp13_;
	_tmp14_ = renderer;
	if (_tmp14_ == NULL) {
		const gchar* _tmp15_ = NULL;
		_tmp15_ = SDL_GetError ();
		g_print ("Unable to get renderer %s\n", _tmp15_);
		_SDL_DestroyRenderer0 (renderer);
		_SDL_DestroyWindow0 (window);
		_g_free0 (name);
		return;
	}
	_tmp16_ = renderer;
	_tmp17_ = game_new (600, 480, _tmp16_);
	game = _tmp17_;
	_tmp18_ = game;
	game_initialize (_tmp18_);
	_tmp19_ = game;
	game_start (_tmp19_);
	_tmp20_ = game;
	emscripten_set_main_loop_arg (_mainloop_em_arg_callback_func, _tmp20_, 0, 1);
	_game_release0 (game);
	_SDL_DestroyRenderer0 (renderer);
	_SDL_DestroyWindow0 (window);
	_g_free0 (name);
}


int main (int argc, char ** argv) {
#if !GLIB_CHECK_VERSION (2,35,0)
	g_type_init ();
#endif
	_vala_main (argv, argc);
	return 0;
}


/**
 * call the main loop
 */
void mainloop (void* arg) {
	Game* game = NULL;
	void* _tmp0_ = NULL;
	gdouble _tmp1_ = 0.0;
	Game* _tmp2_ = NULL;
	gdouble _tmp3_ = 0.0;
	gdouble _tmp4_ = 0.0;
	gdouble _tmp5_ = 0.0;
	gdouble _tmp6_ = 0.0;
	gdouble _tmp7_ = 0.0;
	gint _tmp8_ = 0;
	gint _tmp9_ = 0;
	Game* _tmp12_ = NULL;
	_tmp0_ = arg;
	game = (Game*) _tmp0_;
	_tmp1_ = emscripten_get_now ();
	t1 = _tmp1_ / 1000;
	_tmp2_ = game;
	game_update (_tmp2_);
	_tmp3_ = emscripten_get_now ();
	t2 = _tmp3_ / 1000;
	_tmp4_ = t2;
	_tmp5_ = t1;
	t3 = _tmp4_ - _tmp5_;
	_tmp6_ = t;
	_tmp7_ = t3;
	t = _tmp6_ + _tmp7_;
	_tmp8_ = k;
	k = _tmp8_ + 1;
	_tmp9_ = k;
	if (_tmp9_ == 1000) {
		gdouble _tmp10_ = 0.0;
		gdouble _tmp11_ = 0.0;
		k = 0;
		_tmp10_ = t;
		t = _tmp10_ / 1000.0;
		_tmp11_ = t;
		g_print ("%f\n", _tmp11_);
		t = (gdouble) 0;
	}
	_tmp12_ = game;
	game_draw (_tmp12_);
}



